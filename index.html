<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ğŸ‚ æ­†æ‚¦çš„ç”Ÿæ—¥è›‹ç³•å¢™ ğŸ‚</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: "Microsoft YaHei", "å¾®è½¯é›…é»‘", sans-serif;
            background: linear-gradient(135deg, #fff0f5 0%, #fffacd 100%);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 5px 20px rgba(255, 107, 158, 0.2);
        }
        
        h1 {
            color: #ff6b9d;
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .cake-icon {
            font-size: 48px;
            margin: 20px 0;
        }
        
        .subtitle {
            color: #666;
            font-size: 18px;
        }
        
        .cake-wall {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }
        
        .cake-layer {
            background: linear-gradient(135deg, #fff5f7 0%, #fff 100%);
            border-left: 8px solid #ff6b9d;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease;
        }
        
        .cake-layer:hover {
            transform: translateX(5px);
        }
        
        .layer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px dashed #eee;
        }
        
        .author {
            color: #ff6b9d;
            font-weight: bold;
            font-size: 18px;
        }
        
        .time {
            color: #999;
            font-size: 14px;
        }
        
        .impression {
            color: #666;
            margin-bottom: 15px;
            font-style: italic;
        }
        
        .blessing {
            font-size: 18px;
            color: #333;
            line-height: 1.8;
        }
        
        .blessing::before {
            content: "ğŸ’Œ ";
        }
        
        .add-section {
            text-align: center;
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }
        
        .add-btn {
            display: inline-block;
            background: linear-gradient(135deg, #ff6b9d 0%, #ff8e53 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 20px;
            border-radius: 50px;
            text-decoration: none;
            margin: 20px 0;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .add-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(255, 107, 157, 0.3);
        }
        
        .instructions {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-top: 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }
        
        .instructions h3 {
            color: #ff6b9d;
            margin-bottom: 15px;
            font-size: 22px;
        }
        
        ol {
            padding-left: 25px;
            margin-bottom: 20px;
        }
        
        li {
            margin-bottom: 10px;
            font-size: 16px;
            color: #555;
        }
        
        .counter {
            background: #ff6b9d;
            color: white;
            padding: 10px 20px;
            border-radius: 30px;
            display: inline-block;
            margin: 15px 0;
            font-size: 18px;
        }
        
        .refresh-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
            transition: background 0.3s ease;
        }
        
        .refresh-btn:hover {
            background: #45a049;
        }
        
        footer {
            text-align: center;
            color: #999;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            font-size: 14px;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .cake-icon {
                font-size: 36px;
            }
            
            .add-btn {
                padding: 12px 30px;
                font-size: 18px;
            }
            
            .layer-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .time {
                margin-top: 5px;
            }
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #999;
        }
        
        .error {
            background: #ffebee;
            color: #c62828;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ‚ æ­†æ‚¦çš„ç”Ÿæ—¥è›‹ç³•å¢™ ğŸ‚</h1>
            <div class="cake-icon">ğŸ°ğŸ°ğŸ°</div>
            <p class="subtitle">æ¯ä¸€å±‚è›‹ç³•ï¼Œéƒ½æ˜¯ä¸€ä»½æ¸©æš–çš„ç¥ç¦</p>
        </header>
        
        <div class="cake-wall">
            <h2 style="color: #ff6b9d; margin-bottom: 25px; text-align: center;">âœ¨ å¤§å®¶çš„ç¥ç¦ âœ¨</h2>
            <div id="blessings-container">
                <div class="loading">
                    <p>æ­£åœ¨åŠ è½½å¤§å®¶çš„ç¥ç¦...</p>
                    <p style="margin-top: 20px; font-size: 24px;">â³</p>
                </div>
            </div>
        </div>
        
        <div class="add-section">
            <h2 style="color: #ff6b9d; margin-bottom: 20px;">ğŸ æ·»åŠ ä½ çš„ç¥ç¦</h2>
            <p style="margin-bottom: 20px; color: #666;">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ï¼Œä¸ºæ­†æ‚¦çš„ç”Ÿæ—¥è›‹ç³•æ·»åŠ ä¸€å±‚ç”œèœœçš„ç¥ç¦å§ï¼</p>
            
            <!-- è¿™é‡Œè¦æ›¿æ¢æˆä½ çš„è…¾è®¯æ–‡æ¡£ç¼–è¾‘é“¾æ¥ -->
            <a href="YOUR_EDIT_LINK_HERE" class="add-btn" target="_blank">
                âœ¨ æˆ‘è¦æ·»åŠ ç¥ç¦ âœ¨
            </a>
            
            <p style="margin-top: 20px; color: #888; font-size: 14px;">
                ï¼ˆç‚¹å‡»åä¼šåœ¨æ–°çª—å£æ‰“å¼€ç¥ç¦æ”¶é›†è¡¨ï¼Œå¡«å†™åè®°å¾—åˆ·æ–°æœ¬é¡µé¢æŸ¥çœ‹ï¼‰
            </p>
        </div>
        
        <div class="instructions">
            <h3>ğŸ“ ä½¿ç”¨è¯´æ˜</h3>
            <ol>
                <li>ç‚¹å‡»ä¸Šæ–¹ç²‰è‰²æŒ‰é’®ï¼Œåœ¨è¡¨æ ¼ä¸­æ·»åŠ ä½ çš„ç¥ç¦</li>
                <li>å¡«å†™å®Œæˆåï¼Œç‚¹å‡»ä¸‹æ–¹â€œåˆ·æ–°ç¥ç¦â€æŒ‰é’®æ›´æ–°æ˜¾ç¤º</li>
                <li>ä¹Ÿå¯ä»¥ç›´æ¥åˆ·æ–°æ•´ä¸ªé¡µé¢ï¼ˆæŒ‰F5æˆ–æµè§ˆå™¨åˆ·æ–°æŒ‰é’®ï¼‰</li>
                <li>å°†æœ¬é¡µé¢é“¾æ¥åˆ†äº«ç»™å…¶ä»–åŒå­¦ï¼Œä¸€èµ·ä¸ºæ­†æ‚¦é€ç¥ç¦</li>
            </ol>
            
            <div style="text-align: center; margin: 25px 0;">
                <div class="counter">
                    å·²æœ‰ <span id="blessing-count">0</span> ä¸ªç¥ç¦
                </div>
                <br>
                <button class="refresh-btn" id="refresh-btn">
                    ğŸ”„ åˆ·æ–°ç¥ç¦
                </button>
            </div>
            
            <div id="data-source-info" style="background: #f9f9f9; padding: 15px; border-radius: 10px; margin-top: 20px;">
                <p style="color: #666; font-size: 14px; margin-bottom: 10px;">
                    <strong>æ•°æ®æ¥æºï¼š</strong>è…¾è®¯æ–‡æ¡£è¡¨æ ¼
                </p>
                <p style="color: #888; font-size: 12px;">
                    å¦‚éœ€ä¿®æ”¹è¡¨æ ¼é“¾æ¥ï¼Œè¯·è”ç³»é¡µé¢ç®¡ç†å‘˜
                </p>
            </div>
        </div>
        
        <footer>
            <p>ğŸ‰ ç¥æ­†æ‚¦åŒå­¦ç”Ÿæ—¥å¿«ä¹ï¼ ğŸ‰</p>
            <p style="margin-top: 10px;">åˆ¶ä½œï¼šç­çº§åŒå­¦ | æ›´æ–°äº <span id="update-time">-</span></p>
        </footer>
    </div>
    
    <script>
        // ============================================
        // ğŸ”§ è¿™é‡Œæ˜¯éœ€è¦ä½ ä¿®æ”¹çš„é…ç½®éƒ¨åˆ†
        // ============================================
        
        // ä½ çš„è…¾è®¯æ–‡æ¡£â€œæŸ¥çœ‹é“¾æ¥â€ï¼ˆå¿…é¡»ä¿®æ”¹ï¼ï¼‰
        // è·å–æ–¹æ³•ï¼šæ‰“å¼€è…¾è®¯æ–‡æ¡£ â†’ åˆ†äº« â†’ é€‰æ‹©â€œä»»ä½•äººå¯æŸ¥çœ‹â€ â†’ å¤åˆ¶é“¾æ¥
        const TEN_CENT_DOC_VIEW_URL = "https://docs.qq.com/sheet/DU0tzQVp3V0pPdGtB?tab=BB08J2";
        
        // ä½ çš„è…¾è®¯æ–‡æ¡£â€œç¼–è¾‘é“¾æ¥â€ï¼ˆå¿…é¡»ä¿®æ”¹ï¼ï¼‰
        // è·å–æ–¹æ³•ï¼šæ‰“å¼€è…¾è®¯æ–‡æ¡£ â†’ åˆ†äº« â†’ é€‰æ‹©â€œä»»ä½•äººå¯ç¼–è¾‘â€ â†’ å¤åˆ¶é“¾æ¥
        const TEN_CENT_DOC_EDIT_URL = "https://docs.qq.com/sheet/DU0tzQVp3V0pPdGtB?tab=BB08J2";
        
        // è‡ªåŠ¨åˆ·æ–°æ—¶é—´ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰ï¼Œé»˜è®¤30ç§’åˆ·æ–°ä¸€æ¬¡
        const AUTO_REFRESH_TIME = 30000;
        
        // ============================================
        // ğŸ‚ ä»¥ä¸‹æ˜¯ç¨‹åºä»£ç ï¼Œä¸€èˆ¬ä¸éœ€è¦ä¿®æ”¹
        // ============================================
        
        // æ›´æ–°é¡µé¢ä¸Šçš„ç¼–è¾‘é“¾æ¥
        document.querySelector('.add-btn').href = TEN_CENT_DOC_EDIT_URL;
        
        // è·å–é¡µé¢å…ƒç´ 
        const blessingsContainer = document.getElementById('blessings-container');
        const blessingCountElement = document.getElementById('blessing-count');
        const refreshButton = document.getElementById('refresh-btn');
        const updateTimeElement = document.getElementById('update-time');
        
        // ç¥ç¦æ•°æ®
        let blessings = [];
        
        // æ ¼å¼åŒ–æ—¶é—´
        function formatTime(timeStr) {
            if (!timeStr) return 'åˆšåˆš';
            
            // å¦‚æœæ˜¯ä»Šå¤©ï¼Œæ˜¾ç¤ºæ—¶é—´
            const now = new Date();
            const date = new Date(timeStr);
            
            if (isNaN(date.getTime())) {
                // å¦‚æœä¸æ˜¯æœ‰æ•ˆæ—¥æœŸï¼Œç›´æ¥è¿”å›
                return timeStr;
            }
            
            // è®¡ç®—æ—¶é—´å·®ï¼ˆåˆ†é’Ÿï¼‰
            const diffMinutes = Math.floor((now - date) / (1000 * 60));
            
            if (diffMinutes < 1) {
                return 'åˆšåˆš';
            } else if (diffMinutes < 60) {
                return `${diffMinutes}åˆ†é’Ÿå‰`;
            } else if (diffMinutes < 24 * 60) {
                const hours = Math.floor(diffMinutes / 60);
                return `${hours}å°æ—¶å‰`;
            } else {
                // æ˜¾ç¤ºæ—¥æœŸ
                return date.toLocaleDateString('zh-CN', {
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                }).replace('ä¸Šåˆ', 'AM').replace('ä¸‹åˆ', 'PM');
            }
        }
        
        // æ˜¾ç¤ºç¥ç¦
        function displayBlessings() {
            if (blessings.length === 0) {
                blessingsContainer.innerHTML = `
                    <div class="error">
                        <p>æš‚æ—¶è¿˜æ²¡æœ‰ç¥ç¦å“¦~</p>
                        <p>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®ï¼Œæ·»åŠ ç¬¬ä¸€ä¸ªç¥ç¦å§ï¼</p>
                    </div>
                `;
                blessingCountElement.textContent = '0';
                return;
            }
            
            let html = '';
            
            // æŒ‰æ—¶é—´å€’åºæ’åˆ—ï¼ˆæœ€æ–°çš„åœ¨æœ€ä¸Šé¢ï¼‰
            const sortedBlessings = [...blessings].sort((a, b) => {
                return new Date(b.time || 0) - new Date(a.time || 0);
            });
            
            sortedBlessings.forEach((item, index) => {
                html += `
                <div class="cake-layer">
                    <div class="layer-header">
                        <div class="author">${item.name || 'åŒ¿ååŒå­¦'}</div>
                        <div class="time">${formatTime(item.time)}</div>
                    </div>
                    <div class="impression">
                        <strong>å°è±¡ï¼š</strong>${item.impression || 'æ¸©æš–çš„åŒå­¦'}
                    </div>
                    <div class="blessing">
                        ${item.blessing || 'ç”Ÿæ—¥å¿«ä¹ï¼'}
                    </div>
                </div>
                `;
            });
            
            blessingsContainer.innerHTML = html;
            blessingCountElement.textContent = blessings.length;
            
            // æ›´æ–°æœ€ååˆ·æ–°æ—¶é—´
            const now = new Date();
            updateTimeElement.textContent = now.toLocaleTimeString('zh-CN', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        }
        
        // ä»è…¾è®¯æ–‡æ¡£è·å–æ•°æ®ï¼ˆç®€åŒ–ç‰ˆï¼‰
         async function fetchBlessingsFromTencentDoc() {
            try {
                // æ–¹æ³•1ï¼šå°è¯•ä½¿ç”¨è…¾è®¯æ–‡æ¡£çš„å¯¼å‡ºåŠŸèƒ½
                // å°†æŸ¥çœ‹é“¾æ¥è½¬æ¢ä¸ºå¯¼å‡ºé“¾æ¥
                const exportUrl = TEN_CENT_DOC_VIEW_URL.replace('/sheet/', '/op/sheet/export?format=csv&id=') + '&share=1';
                
                const response = await fetch(exportUrl);
                
                if (!response.ok) {
                    throw new Error('æ— æ³•è¿æ¥åˆ°è…¾è®¯æ–‡æ¡£');
                }
                
                const csvText = await response.text();
                
                // è§£æCSVæ•°æ®ï¼ˆç®€å•è§£æï¼‰
                const lines = csvText.split('\n').filter(line => line.trim() !== '');
                const newBlessings = [];
                
                // ç¬¬ä¸€è¡Œæ˜¯è¡¨å¤´ï¼Œä»ç¬¬äºŒè¡Œå¼€å§‹
                for (let i = 1; i < lines.length; i++) {
                    const cells = lines[i].split(',');
                    
                    // ç®€å•å¤„ç†ï¼šå‰4åˆ—åˆ†åˆ«æ˜¯æ˜µç§°ã€å°è±¡ã€ç¥ç¦è¯­ã€æ—¶é—´
                    if (cells.length >= 3) {
                        newBlessings.push({
                            name: cells[0] ? cells[0].trim() : 'åŒ¿å',
                            impression: cells[1] ? cells[1].trim() : '',
                            blessing: cells[2] ? cells[2].trim() : 'ç”Ÿæ—¥å¿«ä¹ï¼',
                            time: cells[3] ? cells[3].trim() : ''
                        });
                    }
                }
                
                blessings = newBlessings;
                displayBlessings();
                return true;
                
            } catch (error) {
                console.error('è·å–æ•°æ®å¤±è´¥:', error);
                
                // å¦‚æœè·å–å¤±è´¥ï¼Œæ˜¾ç¤ºç¤ºä¾‹æ•°æ®
                showExampleData();
                return false;
            }
        }

        
        // æ˜¾ç¤ºç¤ºä¾‹æ•°æ®ï¼ˆå½“æ— æ³•è·å–è…¾è®¯æ–‡æ¡£æ•°æ®æ—¶ä½¿ç”¨ï¼‰
        function showExampleData() {
            blessings = [
                {
                    name: "æˆ‘ä¸æ˜¯é›¨æ¬£",
                    impression: "é»äººçš„å°çŒ«å’ª",
                    blessing: "ç¥æ­†æ‚¦æ¯å¤©éƒ½æœ‰å®å®äº²äº²",
                    time: "2025-12-14 22:33"
                },
                {
                    name: "å’•å™œå™œ",
                    impression: "å¯çˆ±ï¼æ¸©æš–ï¼",
                    blessing: "æ­†æ‚¦æ­†æ‚¦ï¼Œå¼€å¿ƒå¼€å¿ƒ~",
                    time: "2025-12-14 21:18"
                },
                {
                    name: "666",
                    impression: "å…¨èƒ½",
                    blessing: "ç”Ÿæ—¥å¿«ä¹ï¼æ–°çš„ä¸€å¹´ä¹Ÿè¦è¿‡çš„å¿«ä¹ï¼",
                    time: "2025-12-14 20:39"
                },
                {
                    name: "wyyyyyyyyl",
                    impression: "éå¸¸å–œæ¬¢çœ‹å¸…å“¥ï¼",
                    blessing: "æœ‰æ•°ä¸æ¸…çš„å¸…å“¥è¿½å¥¹~~~æ¯å¤©æœ‰çœ‹ä¸å®Œçš„å¸…å“¥ï¼ï¼ï¼",
                    time: "2025-12-14 20:38"
                },
                {
                    name: "è¾¾åˆ©å›­",
                    impression: "é è°±çš„xyjjï½",
                    blessing: "ç”Ÿæ—¥å¿«ä¹å‘€xyjjï¼å¤©å¤©å¼€å¿ƒï¼",
                    time: "2025-12-14 20:37"
                }
            ];
            
            displayBlessings();
            
            // æ˜¾ç¤ºé”™è¯¯æç¤º
            blessingsContainer.innerHTML = `
                <div class="error">
                    <p>âš ï¸ æ— æ³•è¿æ¥åˆ°è…¾è®¯æ–‡æ¡£ï¼Œæ­£åœ¨æ˜¾ç¤ºç¤ºä¾‹æ•°æ®</p>
                    <p>è¯·æ£€æŸ¥ï¼š</p>
                    <ol style="text-align: left; margin: 10px 0 10px 20px;">
                        <li>æ˜¯å¦æ­£ç¡®è®¾ç½®äº†è…¾è®¯æ–‡æ¡£é“¾æ¥</li>
                        <li>æ˜¯å¦å°†æ–‡æ¡£æƒé™è®¾ç½®ä¸º"ä»»ä½•äººå¯æŸ¥çœ‹"</li>
                        <li>ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸</li>
                    </ol>
                    <p style="margin-top: 15px;"><strong>å½“å‰æ˜¯æ¼”ç¤ºæ¨¡å¼ï¼Œæ•°æ®ä¸ä¼šè‡ªåŠ¨æ›´æ–°</strong></p>
                </div>
                ${blessingsContainer.innerHTML}
            `;
        }
        
        // åˆ·æ–°æ•°æ®
        async function refreshData() {
            refreshButton.disabled = true;
            refreshButton.textContent = 'åŠ è½½ä¸­...';
            
            await fetchBlessingsFromTencentDoc();
            
            refreshButton.disabled = false;
            refreshButton.textContent = 'ğŸ”„ åˆ·æ–°ç¥ç¦';
        }
        
        // é¡µé¢åŠ è½½æ—¶è·å–æ•°æ®
        document.addEventListener('DOMContentLoaded', async () => {
            await refreshData();
            
            // è®¾ç½®è‡ªåŠ¨åˆ·æ–°
            setInterval(refreshData, AUTO_REFRESH_TIME);
            
            // ç»‘å®šåˆ·æ–°æŒ‰é’®äº‹ä»¶
            refreshButton.addEventListener('click', refreshData);
            
            // æ·»åŠ é”®ç›˜å¿«æ·é”®ï¼šæŒ‰Ré”®åˆ·æ–°
            document.addEventListener('keydown', (event) => {
                if (event.key === 'r' || event.key === 'R') {
                    refreshData();
                }
            });
        });
        
        // æ˜¾ç¤ºå½“å‰æ—¶é—´
        function updateCurrentTime() {
            const now = new Date();
            updateTimeElement.textContent = now.toLocaleTimeString('zh-CN', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        }
        
        // æ¯ç§’æ›´æ–°æ—¶é—´
        setInterval(updateCurrentTime, 1000);
        updateCurrentTime();
    </script>
</body>
</html>


