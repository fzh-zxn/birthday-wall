<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ‚ æ­†æ‚¦çš„ç”Ÿæ—¥ç¥ç¦å¢™</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #ff6b9d;
            --secondary-color: #ffd166;
            --background-color: #fff9f9;
            --card-color: #ffffff;
            --text-color: #333333;
            --shadow: 0 5px 15px rgba(255, 107, 157, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', 'Segoe UI', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(255, 215, 102, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(255, 107, 157, 0.1) 0%, transparent 20%);
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 40px 20px;
            margin-bottom: 30px;
            background: linear-gradient(135deg, var(--primary-color), #ff8e53);
            color: white;
            border-radius: 20px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: "ğŸ‚";
            font-size: 100px;
            position: absolute;
            opacity: 0.1;
            top: 10px;
            right: 20px;
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 25px;
            flex-wrap: wrap;
        }
        
        .stat-box {
            background: rgba(255, 255, 255, 0.2);
            padding: 12px 25px;
            border-radius: 50px;
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        @media (max-width: 768px) {
            .content {
                grid-template-columns: 1fr;
            }
        }
        
        .form-section, .blessings-section {
            background-color: var(--card-color);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow);
        }
        
        .section-title {
            color: var(--primary-color);
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        input, textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #eee;
            border-radius: 10px;
            font-family: inherit;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        input:focus, textarea:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 107, 157, 0.2);
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .submit-btn {
            background: linear-gradient(135deg, var(--primary-color), #ff8e53);
            color: white;
            border: none;
            padding: 16px 40px;
            font-size: 1.1rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(255, 107, 157, 0.3);
        }
        
        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .message {
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
            display: none;
        }
        
        .message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }
        
        .message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }
        
        .blessings-container {
            max-height: 600px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .blessing-card {
            background: #fafafa;
            border-left: 5px solid var(--primary-color);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s;
            position: relative;
        }
        
        .blessing-card:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .blessing-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .blessing-author {
            font-weight: bold;
            color: var(--primary-color);
            font-size: 1.1rem;
        }
        
        .blessing-time {
            color: #888;
            font-size: 0.9rem;
        }
        
        .blessing-impression {
            color: #666;
            font-style: italic;
            margin-bottom: 10px;
            padding-left: 10px;
            border-left: 2px dashed #ddd;
        }
        
        .blessing-text {
            font-size: 1.05rem;
            line-height: 1.7;
            white-space: pre-line;
        }
        
        .blessing-text::before {
            content: "ğŸ’Œ ";
        }
        
        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: #888;
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #ddd;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .refresh-btn {
            background: #f0f0f0;
            border: none;
            padding: 10px 20px;
            border-radius: 50px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .refresh-btn:hover {
            background: #e0e0e0;
        }
        
        .auto-refresh-status {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #666;
            font-size: 0.9rem;
        }
        
        .blink {
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        footer {
            text-align: center;
            padding: 30px 20px;
            color: #888;
            font-size: 0.9rem;
            border-top: 1px solid #eee;
            margin-top: 40px;
        }
        
        .security-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
            font-size: 0.9rem;
        }
        
        .security-warning h3 {
            color: #856404;
            margin-bottom: 10px;
        }
        
        .loading {
            text-align: center;
            padding: 30px;
            color: #888;
        }
        
        .pulse {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ‚ æ­†æ‚¦çš„ç”Ÿæ—¥ç¥ç¦å¢™</h1>
            <p class="subtitle">æ¯ä¸€ä»½ç¥ç¦éƒ½æ˜¯ç‰¹åˆ«çš„ç¤¼ç‰©ï¼Œç›´æ¥åœ¨è¿™é‡Œå†™ä¸‹ä½ æƒ³å¯¹å¥¹è¯´çš„è¯å§ï¼</p>
            <div class="stats">
                <div class="stat-box">
                    <i class="fas fa-heart"></i>
                    <span id="blessingsCount">0</span> ä»½ç¥ç¦
                </div>
                <div class="stat-box">
                    <i class="fas fa-sync-alt"></i>
                    <span id="lastUpdate">åˆšåˆš</span>
                </div>
                <div class="stat-box auto-refresh-status">
                    <i class="fas fa-circle blink" style="color: #4CAF50;"></i>
                    è‡ªåŠ¨æ›´æ–°å·²å¼€å¯
                </div>
            </div>
        </header>
        
        <div class="content">
            <section class="form-section">
                <h2 class="section-title"><i class="fas fa-edit"></i> å†™ä¸‹ä½ çš„ç¥ç¦</h2>
                <form id="blessingForm">
                    <div class="form-group">
                        <label for="userName"><i class="fas fa-user"></i> ä½ çš„æ˜µç§° *</label>
                        <input type="text" id="userName" placeholder="ä¾‹å¦‚ï¼šè¾¾åˆ©å›­" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="userImpression"><i class="fas fa-star"></i> ä½ å¯¹æ­†æ‚¦çš„å°è±¡</label>
                        <input type="text" id="userImpression" placeholder="ä¾‹å¦‚ï¼šå¯çˆ±ã€æ¸©æš–ã€å…¨èƒ½...">
                    </div>
                    
                    <div class="form-group">
                        <label for="userBlessing"><i class="fas fa-comment-dots"></i> ç”Ÿæ—¥ç¥ç¦ *</label>
                        <textarea id="userBlessing" placeholder="å†™ä¸‹ä½ æœ€æƒ³å¯¹æ­†æ‚¦è¯´çš„è¯..." required></textarea>
                    </div>
                    
                    <button type="submit" class="submit-btn" id="submitBtn">
                        <i class="fas fa-paper-plane"></i> æäº¤ç¥ç¦
                    </button>
                </form>
                
                <div class="message" id="formMessage"></div>
            </section>
            
            <section class="blessings-section">
                <div class="controls">
                    <h2 class="section-title"><i class="fas fa-birthday-cake"></i> å¤§å®¶çš„ç¥ç¦</h2>
                    <button class="refresh-btn" id="refreshBtn">
                        <i class="fas fa-redo"></i> åˆ·æ–°ç¥ç¦
                    </button>
                </div>
                
                <div class="blessings-container" id="blessingsContainer">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin pulse" style="font-size: 2rem; margin-bottom: 15px;"></i>
                        <p>æ­£åœ¨åŠ è½½ç¥ç¦...</p>
                    </div>
                </div>
            </section>
        </div>
        
        <div class="security-warning">
            <h3><i class="fas fa-exclamation-triangle"></i> é‡è¦å®‰å…¨æç¤º</h3>
            <p>1. æ­¤é¡µé¢ä½¿ç”¨GitHub Tokenç›´æ¥æ“ä½œä½ çš„ä»“åº“ã€‚å¦‚æœå°†æ­¤æ–‡ä»¶å…¬å¼€éƒ¨ç½²ï¼ŒTokenå¯èƒ½ä¼šæš´éœ²ã€‚</p>
            <p>2. <strong>å»ºè®®ä»…åœ¨æµ‹è¯•åé‡ç½®Token</strong>ï¼šæµ‹è¯•æˆåŠŸåï¼Œè¯·ç«‹å³åˆ°GitHubçš„ Settings â†’ Developer settings â†’ Personal access tokens ä¸­é‡ç½®ï¼ˆRevokeï¼‰ä½¿ç”¨çš„Tokenã€‚</p>
            <p>3. è¿™æ ·é¡µé¢å°†ä¿ç•™å±•ç¤ºåŠŸèƒ½ï¼Œä½†æ— æ³•æäº¤æ–°ç¥ç¦ï¼Œé€‚åˆä¸€æ¬¡æ€§æ´»åŠ¨ä½¿ç”¨ã€‚</p>
        </div>
        
        <footer>
            <p>â¤ï¸ ä¸ºæ­†æ‚¦åˆ¶ä½œçš„ç”Ÿæ—¥ç¥ç¦å¢™ | æ•°æ®å®æ—¶ä¿å­˜ä¸åŒæ­¥ | æœ€åæ›´æ–°: <span id="currentTime">-</span></p>
            <p style="margin-top: 10px; font-size: 0.8rem;">ç¥ç¦æäº¤åï¼Œé¡µé¢å°†è‡ªåŠ¨åˆ·æ–°æ˜¾ç¤ºæœ€æ–°å†…å®¹</p>
        </footer>
    </div>

    <script>
        // ============================================
        // ğŸ”§ é…ç½®åŒºåŸŸï¼šè¯·ä¿®æ”¹ä»¥ä¸‹ä¿¡æ¯
        // ============================================
        const CONFIG = {
            // ä½ çš„GitHubç”¨æˆ·åï¼ˆä¸æ˜¯é‚®ç®±ï¼‰
            GITHUB_USER: 'fzh-zxn',
            // å­˜æ”¾æ­¤é¡µé¢çš„ä»“åº“å
            GITHUB_REPO: 'brithday-wall',
            // ä½ çš„GitHubä¸ªäººè®¿é—®ä»¤ç‰Œï¼ˆPersonal Access Tokenï¼‰
            // è·å–æ–¹å¼ï¼šGitHub â†’ Settings â†’ Developer settings â†’ Personal access tokens â†’ Generate new token (classic)
            // æƒé™éœ€è¦å‹¾é€‰ï¼šrepo (å…¨éƒ¨)
            // âš ï¸ è­¦å‘Šï¼šéƒ¨ç½²åè¯·ç«‹å³é‡ç½®æ­¤Tokenï¼Œä»¥é˜²æ³„éœ²ï¼
            GITHUB_TOKEN: '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',
            // å­˜å‚¨ç¥ç¦æ•°æ®çš„JSONæ–‡ä»¶è·¯å¾„
            DATA_FILE_PATH: 'birthday-data.json',
            // è‡ªåŠ¨åˆ·æ–°é—´éš”ï¼ˆæ¯«ç§’ï¼‰
            AUTO_REFRESH_INTERVAL: 30000, // 30ç§’
            // æ¯é¡µæ˜¾ç¤ºçš„æœ€å¤§ç¥ç¦æ•°é‡
            MAX_BLESSINGS: 100
        };
        // ============================================
        // ğŸ‚ ä»¥ä¸‹ä¸ºç¨‹åºä»£ç ï¼Œä¸€èˆ¬æ— éœ€ä¿®æ”¹
        // ============================================
        
        // å…¨å±€å˜é‡
        let blessings = [];
        let currentBlessingsCount = 0;
        let autoRefreshInterval;
        
        // DOM å…ƒç´ 
        const blessingsContainer = document.getElementById('blessingsContainer');
        const blessingsCountEl = document.getElementById('blessingsCount');
        const lastUpdateEl = document.getElementById('lastUpdate');
        const currentTimeEl = document.getElementById('currentTime');
        const form = document.getElementById('blessingForm');
        const formMessage = document.getElementById('formMessage');
        const submitBtn = document.getElementById('submitBtn');
        const refreshBtn = document.getElementById('refreshBtn');
        
        // å·¥å…·å‡½æ•°ï¼šæ ¼å¼åŒ–æ—¶é—´
        function formatTime(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / (1000 * 60));
            const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
            
            if (diffMins < 1) {
                return 'åˆšåˆš';
            } else if (diffMins < 60) {
                return `${diffMins}åˆ†é’Ÿå‰`;
            } else if (diffHours < 24) {
                return `${diffHours}å°æ—¶å‰`;
            } else {
                return date.toLocaleDateString('zh-CN', {
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
        }
        
        // å·¥å…·å‡½æ•°ï¼šæ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(text, type = 'success') {
            formMessage.textContent = text;
            formMessage.className = `message ${type}`;
            formMessage.style.display = 'block';
            
            if (type === 'success') {
                setTimeout(() => {
                    formMessage.style.display = 'none';
                }, 5000);
            }
        }
        
        // ä»GitHubè·å–ç¥ç¦æ•°æ®
        async function fetchBlessingsFromGitHub() {
            try {
                // ä½¿ç”¨GitHub APIè·å–æ–‡ä»¶å†…å®¹
                const apiUrl = `https://api.github.com/repos/${CONFIG.GITHUB_USER}/${CONFIG.GITHUB_REPO}/contents/${CONFIG.DATA_FILE_PATH}`;
                
                const response = await fetch(apiUrl, {
                    headers: {
                        'Authorization': `token ${CONFIG.GITHUB_TOKEN}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (!response.ok) {
                    // å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºç©ºæ•°ç»„
                    if (response.status === 404) {
                        return [];
                    }
                    throw new Error(`GitHub APIé”™è¯¯: ${response.status}`);
                }
                
                const fileData = await response.json();
                // GitHub APIè¿”å›çš„å†…å®¹æ˜¯Base64ç¼–ç çš„
                const content = atob(fileData.content);
                return JSON.parse(content);
                
            } catch (error) {
                console.error('è·å–æ•°æ®å¤±è´¥:', error);
                // å°è¯•ä»rawåœ°å€è·å–ï¼ˆåªè¯»ï¼‰
                try {
                    const rawUrl = `https://raw.githubusercontent.com/${CONFIG.GITHUB_USER}/${CONFIG.GITHUB_REPO}/main/${CONFIG.DATA_FILE_PATH}`;
                    const rawResponse = await fetch(rawUrl + '?t=' + Date.now());
                    if (rawResponse.ok) {
                        return await rawResponse.json();
                    }
                } catch (rawError) {
                    console.error('ä»rawåœ°å€è·å–ä¹Ÿå¤±è´¥:', rawError);
                }
                
                // å¦‚æœéƒ½å¤±è´¥äº†ï¼Œè¿”å›ç©ºæ•°ç»„
                return [];
            }
        }
        
        // ä¿å­˜ç¥ç¦æ•°æ®åˆ°GitHub
        async function saveBlessingsToGitHub(newBlessings) {
            try {
                // é¦–å…ˆè·å–å½“å‰æ–‡ä»¶ä¿¡æ¯ï¼ˆä¸ºäº†è·å–shaï¼‰
                const getUrl = `https://api.github.com/repos/${CONFIG.GITHUB_USER}/${CONFIG.GITHUB_REPO}/contents/${CONFIG.DATA_FILE_PATH}`;
                const getResponse = await fetch(getUrl, {
                    headers: {
                        'Authorization': `token ${CONFIG.GITHUB_TOKEN}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                let sha = null;
                if (getResponse.ok) {
                    const fileData = await getResponse.json();
                    sha = fileData.sha;
                }
                
                // å‡†å¤‡æ›´æ–°å†…å®¹
                const content = JSON.stringify(newBlessings, null, 2);
                const contentBase64 = btoa(unescape(encodeURIComponent(content)));
                
                // æ›´æ–°æ–‡ä»¶
                const updateUrl = `https://api.github.com/repos/${CONFIG.GITHUB_USER}/${CONFIG.GITHUB_REPO}/contents/${CONFIG.DATA_FILE_PATH}`;
                const updateResponse = await fetch(updateUrl, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${CONFIG.GITHUB_TOKEN}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: `æ·»åŠ æ–°ç¥ç¦ - ${new Date().toLocaleString('zh-CN')}`,
                        content: contentBase64,
                        sha: sha
                    })
                });
                
                if (!updateResponse.ok) {
                    const errorText = await updateResponse.text();
                    throw new Error(`æ›´æ–°å¤±è´¥: ${updateResponse.status} - ${errorText}`);
                }
                
                return true;
            } catch (error) {
                console.error('ä¿å­˜æ•°æ®å¤±è´¥:', error);
                throw error;
            }
        }
        
        // æ·»åŠ æ–°ç¥ç¦
        async function addNewBlessing(name, impression, blessingText) {
            // åˆ›å»ºæ–°ç¥ç¦å¯¹è±¡
            const newBlessing = {
                id: Date.now(), // ä½¿ç”¨æ—¶é—´æˆ³ä½œä¸ºID
                name: name.trim(),
                impression: impression ? impression.trim() : '',
                blessing: blessingText.trim(),
                time: new Date().toISOString()
            };
            
            // æ·»åŠ åˆ°æ•°ç»„å¼€å¤´
            blessings.unshift(newBlessing);
            
            // åªä¿ç•™æœ€è¿‘çš„ä¸€å®šæ•°é‡çš„ç¥ç¦
            if (blessings.length > CONFIG.MAX_BLESSINGS) {
                blessings = blessings.slice(0, CONFIG.MAX_BLESSINGS);
            }
            
            // ä¿å­˜åˆ°GitHub
            await saveBlessingsToGitHub(blessings);
            
            return newBlessing;
        }
        
        // æ¸²æŸ“ç¥ç¦åˆ—è¡¨
        function renderBlessings() {
            if (blessings.length === 0) {
                blessingsContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-gift"></i>
                        <h3>è¿˜æ²¡æœ‰ç¥ç¦å“¦</h3>
                        <p>å¿«æ¥å†™ä¸‹ç¬¬ä¸€ä¸ªç¥ç¦å§ï¼</p>
                    </div>
                `;
                blessingsCountEl.textContent = '0';
                return;
            }
            
            let html = '';
            blessings.forEach(blessing => {
                html += `
                <div class="blessing-card">
                    <div class="blessing-header">
                        <div class="blessing-author">${escapeHtml(blessing.name)}</div>
                        <div class="blessing-time">${formatTime(blessing.time)}</div>
                    </div>
                    ${blessing.impression ? `<div class="blessing-impression">å°è±¡ï¼š${escapeHtml(blessing.impression)}</div>` : ''}
                    <div class="blessing-text">${escapeHtml(blessing.blessing)}</div>
                </div>
                `;
            });
            
            blessingsContainer.innerHTML = html;
            blessingsCountEl.textContent = blessings.length;
            currentBlessingsCount = blessings.length;
            
            // æ›´æ–°æœ€ååˆ·æ–°æ—¶é—´
            lastUpdateEl.textContent = 'åˆšåˆš';
            updateCurrentTime();
        }
        
        // åŠ è½½ç¥ç¦æ•°æ®
        async function loadBlessings() {
            try {
                blessings = await fetchBlessingsFromGitHub();
                renderBlessings();
            } catch (error) {
                console.error('åŠ è½½ç¥ç¦å¤±è´¥:', error);
                showMessage('åŠ è½½ç¥ç¦å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', 'error');
            }
        }
        
        // å¤„ç†è¡¨å•æäº¤
        async function handleFormSubmit(event) {
            event.preventDefault();
            
            const name = document.getElementById('userName').value.trim();
            const impression = document.getElementById('userImpression').value.trim();
            const blessingText = document.getElementById('userBlessing').value.trim();
            
            if (!name) {
                showMessage('è¯·è¾“å…¥ä½ çš„æ˜µç§°', 'error');
                return;
            }
            
            if (!blessingText) {
                showMessage('è¯·è¾“å…¥ç¥ç¦å†…å®¹', 'error');
                return;
            }
            
            // ç¦ç”¨æäº¤æŒ‰é’®ï¼Œé˜²æ­¢é‡å¤æäº¤
            const originalBtnText = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> æäº¤ä¸­...';
            
            try {
                await addNewBlessing(name, impression, blessingText);
                
                // æ¸…ç©ºè¡¨å•
                form.reset();
                
                // é‡æ–°æ¸²æŸ“ç¥ç¦åˆ—è¡¨
                renderBlessings();
                
                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                showMessage(`âœ… æ„Ÿè°¢ ${name} çš„ç¥ç¦ï¼å·²æˆåŠŸæäº¤ã€‚`);
                
            } catch (error) {
                console.error('æäº¤å¤±è´¥:', error);
                showMessage('æäº¤å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–Tokenè®¾ç½®', 'error');
            } finally {
                // æ¢å¤æäº¤æŒ‰é’®
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalBtnText;
            }
        }
        
        // æ‰‹åŠ¨åˆ·æ–°ç¥ç¦
        async function handleManualRefresh() {
            const originalBtnText = refreshBtn.innerHTML;
            refreshBtn.disabled = true;
            refreshBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> åˆ·æ–°ä¸­...';
            
            await loadBlessings();
            
            refreshBtn.disabled = false;
            refreshBtn.innerHTML = originalBtnText;
        }
        
        // æ›´æ–°å½“å‰æ—¶é—´æ˜¾ç¤º
        function updateCurrentTime() {
            const now = new Date();
            currentTimeEl.textContent = now.toLocaleTimeString('zh-CN', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        }
        
        // å¯åŠ¨è‡ªåŠ¨åˆ·æ–°
        function startAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
            
            autoRefreshInterval = setInterval(async () => {
                // æ£€æŸ¥ç¥ç¦æ•°é‡æ˜¯å¦æœ‰å˜åŒ–
                const oldCount = currentBlessingsCount;
                await loadBlessings();
                
                if (currentBlessingsCount > oldCount) {
                    // æœ‰æ–°çš„ç¥ç¦ï¼Œæ˜¾ç¤ºé€šçŸ¥
                    lastUpdateEl.innerHTML = `<span style="color: #4CAF50;">æœ‰${currentBlessingsCount - oldCount}æ¡æ–°ç¥ç¦</span>`;
                } else if (currentBlessingsCount < oldCount) {
                    // ç¥ç¦æ•°é‡å‡å°‘ï¼ˆç†è®ºä¸Šä¸ä¼šå‘ç”Ÿï¼‰
                    loadBlessings();
                }
            }, CONFIG.AUTO_REFRESH_INTERVAL);
        }
        
        // ç®€å•çš„HTMLè½¬ä¹‰ï¼Œé˜²æ­¢XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // åˆå§‹åŒ–é¡µé¢
        async function initPage() {
            // è®¾ç½®å½“å‰æ—¶é—´
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
            
            // ç»‘å®šäº‹ä»¶
            form.addEventListener('submit', handleFormSubmit);
            refreshBtn.addEventListener('click', handleManualRefresh);
            
            // åŠ è½½åˆå§‹æ•°æ®
            await loadBlessings();
            
            // å¯åŠ¨è‡ªåŠ¨åˆ·æ–°
            startAutoRefresh();
            
            // æ£€æŸ¥Tokenæ˜¯å¦å·²é…ç½®
            if (CONFIG.GITHUB_TOKEN.includes('ä½ çš„GitHub_Token')) {
                showMessage('âš ï¸ è¯·å…ˆé…ç½®GitHub Tokenï¼Œå¦åˆ™æ— æ³•æäº¤ç¥ç¦ï¼', 'error');
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="fas fa-exclamation-triangle"></i> éœ€è¦é…ç½®Token';
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initPage);
    </script>
</body>
</html>
       




